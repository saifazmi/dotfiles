# ENVIRONMENT {{{
  # set XDG paths with fallbacks
  %if #{==:#{XDG_CONFIG_HOME},}
    set-environment -g XDG_CONFIG_HOME "$HOME/.config"
  %endif
  %if #{==:#{XDG_DATA_HOME},}
    set-environment -g XDG_DATA_HOME "$HOME/.local/share"
  %endif
#}}}

# KEY_BINDINGS {{{
  # remap prefix from 'Ctrl-b' to 'Ctrl-a'
  unbind C-b
  set-option -g prefix C-a
  bind-key C-a send-prefix

  # split panes using | and -
  unbind %
  bind | split-window -h -c '#{pane_current_path}'
  unbind '"'
  bind - split-window -v -c '#{pane_current_path}'

  # start selecting text with 'v'
  bind-key -T copy-mode-vi 'v' send -X begin-selection
  # copy text with 'y'
  bind-key -T copy-mode-vi 'y' send -X copy-selection

  # don't exit copy mode after dragging with mouse
  unbind -T copy-mode-vi MouseDragEnd1Pane

  # resize panes with hjkl
  bind -r j resize-pane -D 5
  bind -r k resize-pane -U 5
  bind -r l resize-pane -R 5
  bind -r h resize-pane -L 5

  # Remap key binding for plugin cleanup (alt key doesn't work on macos)
  set -g @tpm-clean 'u'

  # reload config file
  unbind r
  bind r source-file $XDG_CONFIG_HOME/tmux/tmux.conf
#}}}

# UI {{{
  # enable 256 color support
  set -g default-terminal 'tmux-256color'
  set -as terminal-features ',xterm-256color:RGB'

  source-file $XDG_CONFIG_HOME/tmux/tmux.catppuccin.conf
#}}}

# OPTIONS {{{
  # enable mouse mode (tmux 2.1 and above)
  set -g mouse on

  # set scrollable buffer size
  set -g history-limit 50000

  # vim movements for tmux copy mode
  set-window-option -g mode-keys vi

  setw -g aggressive-resize on
  # tmux resurrect capture on
  set -g @resurrect-capture-pane-contents 'on'
  # tmux continuum backup on
  set -g @continuum-restore 'on'
#}}}

# PLUGINS {{{
  # set plugin directory to XDG data home
  %if #{==:#{TMUX_PLUGIN_MANAGER_PATH},}
    set-environment -g TMUX_PLUGIN_MANAGER_PATH "$XDG_DATA_HOME/tmux/plugins"
  %endif

  # bootstrap tpm if not installed
  if "test ! -d $XDG_DATA_HOME/tmux/plugins/tpm" \
     "run 'git clone https://github.com/tmux-plugins/tpm $XDG_DATA_HOME/tmux/plugins/tpm && \
           $XDG_DATA_HOME/tmux/plugins/tpm/bin/install_plugins'"

  # tpm plugin
  set -g @plugin 'tmux-plugins/tpm'

    # for configuring theme
    set -g @plugin 'catppuccin/tmux'
    # battery dependency for catppuccin/tmux
    set -g @plugin 'tmux-plugins/tmux-battery'
    # for online/offline status
    set -g @plugin 'tmux-plugins/tmux-online-status'
    # for navigating panes and vim/nvim with Ctrl-hjkl
    set -g @plugin 'christoomey/vim-tmux-navigator'
    # for tmux sessions persist after computer restart
    set -g @plugin 'tmux-plugins/tmux-resurrect'
    # for tmux sessions auto session saves every 15 minutes
    set -g @plugin 'tmux-plugins/tmux-continuum'

  # initialize plugin manager (keep this at the very bottom)
  run '$XDG_DATA_HOME/tmux/plugins/tpm/tpm'
#}}}
